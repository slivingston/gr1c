<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>gr1c: Developer&#39;s introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="gr1cdoc.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">gr1c
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Developer's introduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes how to navigate the code in a way useful to those who wish to modify it, link against, etc.</p>
<p>The main program for users is <code>gr1c</code>. Besides access to the basic GR(1) synthesis routine, <code>gr1c</code> handles commands like <code>gr1c rg</code> that cause separate programs to be invoked, e.g., <code>gr1c-rg</code>. These programs must be on the system path, so <code>./gr1c rg</code> may fail if the local directory is not on the path. To add it, try </p><pre class="fragment">export PATH=`pwd`:$PATH
</pre><h2>Layout of the sources </h2>
<dl>
<dt><code>.</code> </dt>
<dd><p class="startdd">Root directory of the source tree. Contains LICENSE.txt, the directories listed below, etc.</p>
<p class="enddd"></p>
</dd>
<dt><code>src/</code> </dt>
<dd><p class="startdd">Source code. Noteworthy files for beginning to learn the internals of gr1c include: </p><ul>
<li>
<code><a class="el" href="common_8h.html" title="Project-wide definitions and macros. ">common.h</a></code>, which defines the version number. </li>
<li>
<code>main.c</code>, main entry point for the program <code>gr1c</code>. </li>
<li>
<code>rg_main.c</code>, main entry point for the program <code>gr1c-rg</code>. </li>
</ul>
<p class="enddd"></p>
</dd>
<dt><code>exp/</code> </dt>
<dd><p class="startdd">Consult <code>exp/README.txt</code>. The main entry point for the program <code>gr1c-patch</code> is in <code>exp/grpatch.c</code>.</p>
<p class="enddd"></p>
</dd>
<dt><code>aux/</code> </dt>
<dd><p class="startdd">Consult <code>aux/README.txt</code>. The main entry point for the program <code>gr1c-autman</code> is in <code>aux/autman.c</code>.</p>
<p class="enddd"></p>
</dd>
<dt><code>examples/</code> </dt>
<dd><p class="startdd">Example specifications, edge change files, etc. Some files are intended for use with the program <code>gr1c</code>, others with <code>rg</code>, and still others with <code>grpatch</code> and <code>grjit</code>, or some combination thereof. Documentation for examples is provided in <code>examples/README.md</code> or in comments at the top of the respective file.</p>
<p class="enddd"></p>
</dd>
<dt><code>tests/</code> </dt>
<dd><p class="startdd">A test suite, which is usually invoked by <code>make check</code> from the root directory. Tests are built and run by <code>tests/Makefile</code>. An environment variable <code>VERBOSE</code> may be set to 1 to indicate that testing progress should be reported as it happens.</p>
<p class="enddd"></p>
</dd>
<dt><code>doc/</code> </dt>
<dd><p class="startdd">Documentation source files and configuration.</p>
<p class="enddd"></p>
</dd>
<dt><code>packaging/</code> </dt>
<dd><p class="startdd">Consult <code>packaging/README.txt</code>.</p>
<p class="enddd"></p>
</dd>
</dl>
<h2>Design notes </h2>
<h3>Non-boolean domains</h3>
<p>Internally, variables of non-Boolean domains are mapped into a set of Boolean variables that use the original variable name as a prefix and then append the corresponding bit index. E.g., <code>y</code> with domain of {0,1,2} would translate to 2 variables, <code>y0</code>, <code>y1</code> that are used to encode the bitvectors 00, 01, and 10. 11 (i.e., <code>y0</code> and <code>y1</code> both set to <code>True</code>) is unreachable.</p>
<p>A significant consequence is that the number of states generated internally happens at boundaries of powers of two, e.g., so that an integer variable domain of <code>[0,513]</code> incurs the same number of states as <code>[0,1023]</code>.</p>
<h2>Quality assurance </h2>
<h3>Test coverage</h3>
<p>Test coverage can be measured by <a href="https://gcc.gnu.org/onlinedocs/gcc/Gcov.html">gcov</a>, which is distributed with <a href="https://gcc.gnu.org">GCC</a>. To use it, add <code>-fprofile-arcs -ftest-coverage</code> to CFLAGS and <code>-lgcov</code> to LDFLAGS in the root Makefile and tests/Makefile. Examples of how to do so are in the comments of these Makefiles. Then, <code>make check</code> to run all tests. (Consider doing <code>make clean &amp;&amp; make all</code> before to ensure that all built files are up-to-date.) The coverage report for a source file can be obtained from <code>gcov</code> by calling it with the file name. E.g., </p><pre class="fragment">gcov automaton.c
</pre><p>will produce automaton.c.gcov, which describes coverage of src/automaton.c. To obtain coverage-annotated files for all C source code, try </p><pre class="fragment">for k in `find src exp aux -name \*.c`; do gcov `basename ${k}`; done
</pre><h3>Static analysis</h3>
<p>Usage on gr1c of several tools for static analysis, i.e., tools that examine the source code without running the programs, are given below. The treatment is not exhaustive. For Clang static analyzer <a href="http://clang-analyzer.llvm.org">http://clang-analyzer.llvm.org</a>, try </p><pre class="fragment">scan-build make all
</pre><p>For cppcheck <a href="http://cppcheck.sourceforge.net">http://cppcheck.sourceforge.net</a>, try </p><pre class="fragment">cppcheck --enable=all src 2&gt; cppcheck-issues.txt
</pre><p>Other websites about cppcheck are <a href="https://github.com/danmar/cppcheck/">https://github.com/danmar/cppcheck/</a> and <a href="https://sourceforge.net/projects/cppcheck/">https://sourceforge.net/projects/cppcheck/</a>.</p>
<h3>Dynamic analysis</h3>
<p>Several tools for dynamic analysis, i.e., tools that examine the behavior of live processes, are listed below. The treatment is not exhaustive.</p>
<ul>
<li>Tools that use the Valgrind instrumentation framework, which are available at <a href="http://www.valgrind.org">http://www.valgrind.org</a></li>
</ul>
<h2>Making releases </h2>
<p>Scripts and other files useful for creating release distributions are under <code>packaging/</code>. Currently these are Git-agnostic, so the version must be explicitly declared by setting the environment variable <code>GR1C_VERSION</code>. If Git is installed and a release commit is checked-out, then try </p><pre class="fragment">export GR1C_VERSION=`git describe --tags --candidates=0 HEAD|cut -c 2-`
</pre><h3>The checklist</h3>
<ul>
<li>Update the CHANGELOG.</li>
<li>Add copyright year where appropriate.</li>
<li>Tag and sign.</li>
<li>Create release note on GitHub.</li>
<li>Build and post API manual of this release.</li>
</ul>
<h2>Code style </h2>
<p>Version numbers are of the form MAJOR.MINOR.MICRO; when a tag is made for a release, it must be named as the version number preceded by "v", e.g., "v0.6.1" for version 0.6.1. The next commit following a release tag should use a version number greater than that of the tag. For example, the first commit after that tagged "v0.6.1" has version 0.6.2.</p>
<p>For C, I mostly prefer the <a href="https://www.kernel.org/">Linux</a> kernel style (as expounded in Documentation/CodingStyle in the Linux source tree), except that indentation should use spaces (not tab charactors) and be in units of 4 spaces. Documentation in source code should usually be line-wrapped at 70 characters (default in Emacs), but more importantly, lines of code or comments should rarely exceed 80 characters in length. README or other plain text files describing nearby stuff are written in <a href="http://daringfireball.net/projects/markdown/">Markdown</a> and line-wrapped at 80 characters. Many comments in the code (e.g., if beginning with <code>/**</code>) and <code>.md</code> files under the <code>doc</code> directory are processed by <a href="http://www.doxygen.org">Doxygen</a>. With <a href="http://www.gnu.org/software/emacs/">Emacs</a> it may be possible to achieve the correct line width and tab conventions by adding the following to your <code>.emacs</code> configuration file. </p><pre class="fragment">(add-hook 'rst-mode-hook
  '(lambda ()
 (setq fill-column 80)))

(add-hook 'c-mode-common-hook
      '(lambda ()
    (c-add-style "scott-c-style" scott-c-style t)))

(add-hook 'c++-mode-common-hook
  '(lambda ()
(c-add-style "scott-c-style" scott-c-style t)))

(setq scott-c-style
  '((tab-width . 4)
   (indent-tabs-mode . nil)
   (c-basic-offset . 4)))</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
